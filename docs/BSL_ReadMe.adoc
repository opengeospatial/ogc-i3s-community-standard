== Building Scene Layer (1.3)

Building content is often derived from https://en.wikipedia.org/wiki/Building_information_modeling[Building Information Modeling] (BIM) workflows. BIM is a best-practice process for optimizing design and construction. BIM processes can produce 3D virtual representations of real-world assets that are commonly used for construction, documentation, and evaluation. BIM processes are applied in multiple domains including architecture, buildings, energy, utilities, and transportation. A Building Scene Layer (BSL) can represent the 3D model content based on BIM structuring disciplines such as architectural or structural, and categories such as windows or walls.

*Examples*: Building Scene Layer example https://3dcities.maps.arcgis.com/home/item.html?id=3e6417f6544b422496a022f6e84aeaaa[SLPK]. Building Scene Layer example https://3dcities.maps.arcgis.com/home/item.html?id=bc11dd06a20546509679c1b3bc83380d[service].

_Example of a Building Scene Layer_

image:../images/buildingSceneLayer.png[Building Scene Layer]

=== Building Scene Layers and Filters

BSLs are visually complex. As such, being able to filter elements or parts of a building to see only the relevant or important information that you are looking for is very useful.

For example, if you want to see parts of a building that are on the second floor, you can set a filter to only show the second floor as solid. In other cases, you may be interested in seeing only the load bearing walls on the second floor and show other elements on that floor as wireframe. You can achieve these different scenarios by applying a building filter to a BSL. You can choose one active filter at a time.

Using the I3S Filter Classes, the user can define a building filter. A building filter enables the user and/or client to make elements of a building visible as either solid or wireframe. Each building filter contains one or many filter blocks. Filter blocks define what is visible in the building scene layer. 

In the filter block, you can define types that represent a field in the category layers. Any field that is defined in all category layers can be selected as a filter type. Each type has a list of values that you can select. By selecting a value, you are making the elements visible that contain this value. The type defines what you can filter on. 

When using filter blocks, remember that the order of the filter blocks is important. You can change the order of the filter blocks by dragging or right-clicking the filter block and selecting move up or down in the Building Filter pane. The order of filter blocks influences the order in which the filter blocks are applied. For example, if a filter block using a wireframe mode is on top, the elements that comply to that filter block are drawn in wireframe, even though the element may also comply to the other filter block defined. In this way, you can define the visual representation of the complex building information by combining the filter blocks.

=== Building Scene Layer Structure

An I3S BSL encoding contains discipline, such as architectural, and category layers, such as walls, as sublayers that represent a building and its assets. BSLs can be represented as a scene layer package (*.slpk) or an I3S service. A BSL contains the following:

* link:layer.bld.adoc[3DSceneLayer]
* link:sublayer.bld.adoc[sublayer]
* link:stats.bld.adoc[statistics]

=== Example of building scene scene layer structure

....
.<host>/SceneServer/layers
  +--0 // scene layer document
  |  +-- statistics
  |  |   +-- summary.json
  |  +-- sublayers
  |  |  +--0 // sublayer document
  |  |  |  +-- nodePages
  |  |  |  |  +-- 0
  |  |  |  |  +-- (...)
  |  |  |  +--nodes
  |  |  |  |  +--0
  |  |  |  |  |  +-- attributes
  |  |  |  |  |  |  +--f_2
  |  |  |  |  |  |  +--f_4
  |  |  |  |  |  |  +--(...)
  |  |  |  |  |  +-- geometries
  |  |  |  |  |  |  +-- 0
  |  |  |  |  |  +-- textures
  |  |  |  |  |  |  +-- 0
  |  |  |  |  |  |  +-- 0_0_1
  |  |  |  |  |  |  +--(...)
  |  |  |  |  |  +-- 3dNodeIndexDocument*
  |  |  |  |  |  +-- shared* 
  |  |  |  |  (...) 
  |  |  |  +--statistics
  |  |  |  | +-- f_2
  |  |  |  |  |  | +--0
  |  |  |  |  +-- f_4
  |  |  |  |  |  | +--0
  |  |  |  |  +-- (...)
....

_* Only required for 1.6 compatability for older clients._

== HTTP API Overview

The following API methods are available for accessing an I3S Building Scene Layer:

*Scene Layer Document*

|===
|Type |JSON
|URL Template |http://serviceURL/layers/\{layerID}
|Example |http://my.server.com/BuildingSceneLayer/SceneServer/layers/0
|Description | This is the root document for the service that will contain properties common to the entire layer. layerID: Integer. ID of the associated layer.
|===

link:layer.bld.adoc[3DSceneLayer]

*Sublayer Document*

|===
|Type | JSON
|URL Template |http://serviceURL/layers/\{layerID}/sublayers/\{sublayerID}
|Example | http://my.server.com/BuildingSceneLayer/SceneServer/layers/0/sublayers/33 http://my.server.com/BuildingSceneLayer/SceneServer/layers/0/sublayers/33/nodes/0/geometries/0
|Description | Discipline or category layer. +
`layerID` Integer. ID of the associated layer. +
`sublayerID` Integer. ID of the associated resource.
|===

link:sublayer.bld.adoc[sublayer]

*Statistics*

|===
|Type | JSON
|URL Template | http://serviceURL/layers/\{layerID}/statistics/summary
|Example | http://my.server.com/3DObjectSceneLayer/SceneServer/layers/0/statistics/summary
|Description | The statistics for the entire layer for a specific attribute. +
`layerID` Integer. ID of the associated layer.
|===

link:stats.bld.adoc[statistics]
